@using BlazorWebAppITBI.Models
@using System.Collections
@rendermode InteractiveServer
@inject IDialogService DialogService
@inject HttpClient Http

<FluentAccordion ExpandMode="AccordionExpandMode.Single">
    @if (Content != null)
    {
        @foreach (var divida in Content.AsQueryable().OrderBy(o=>o.ItbiedifParc))
        {
            <FluentAccordionItem Expanded="false">
                <HeadingTemplate>
                    <FluentStack Orientation="Orientation.Horizontal">
                        @if (divida.ItbiedifParc == 0)
                        {
                            <FluentNumberField ReadOnly @bind-Value="@divida.ItbiedifVlrDevido">Parcela Única</FluentNumberField>
                        }else{
                            <FluentNumberField ReadOnly @bind-Value="@divida.ItbiedifVlrDevido">Parcela : $"{divida.ItbiedifVlrDevido}"</FluentNumberField>
                        }
                        @{
                            var dt = divida.ItbiedifDataVenc.ToString();
                            <FluentTextField ReadOnly @bind-Value="@dt">Data Vencimento:</FluentTextField>
                            var sit = divida.ImoIddividaNavigation.TipoBxId == 1 ? "Pendente" : "Paga";
                            <FluentTextField ReadOnly @bind-Value=@sit >Situação:</FluentTextField>
                            <FluentButton Appearance="Appearance.Outline" OnClick="()=>Imprimir(divida)"
                                          IconStart="@(new Icons.Regular.Size20.DocumentPrint().WithColor(Color.Accent))">
                            </FluentButton>
                        }
                    </FluentStack>
                </HeadingTemplate>
             
            </FluentAccordionItem>
        }
    }
</FluentAccordion>
@code {
    [Parameter]
    public string? ExternalPageContent { get; set; }
    [Parameter]
    public List<TribItbiedif>? Content { get; set; }
    [Parameter]
    public EventCallback<TribItbiedif> ImprimirGuia { get; set; }
    private async void Imprimir(TribItbiedif dividaitbi)
    {
        await ImprimirGuia.InvokeAsync(dividaitbi);
        StateHasChanged();
        try
        {
            ExternalPageContent = await Http.GetStringAsync(ExternalPageContent);
        }
        catch (Exception ex)
        {
            // Lidar com erros, se necessário
            Console.WriteLine($"Erro ao buscar conteúdo: {ex.Message}");
        }
    }
   
}

